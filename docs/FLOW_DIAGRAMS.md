# ğŸ“Š System Flow Diagrams

## 1. Order Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CUSTOMER ORDER FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Customer â”‚
â”‚  Browses  â”‚
â”‚   Menu    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Select Items &   â”‚
â”‚    Modifiers      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Add to Cart     â”‚
â”‚ (Local Storage)   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Review Cart &    â”‚
â”‚  Edit Quantities  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      NO     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Logged In?  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Login/Signup â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ YES                                â”‚
      â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Select/Add       â”‚
â”‚  Delivery Address â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Select Payment    â”‚
â”‚     Method        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Add Tip &       â”‚
â”‚   Instructions    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Review Order    â”‚
â”‚   & Place Order   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND PROCESSING                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Validate Order Data                                    â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Calculate Totals (subtotal, tax, delivery, tip)       â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Check Loyalty Points (if redeeming)                   â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Create Order in Database                               â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”œâ”€â”€â†’ Order Table (header)                             â”‚
â”‚     â”œâ”€â”€â†’ OrderItems Table (line items)                    â”‚
â”‚     â”œâ”€â”€â†’ OrderItemModifiers Table (modifiers)             â”‚
â”‚     â””â”€â”€â†’ Payment Table (payment record)                   â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Post Order to POS Database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚     â”‚                                        â”‚             â”‚
â”‚     â”œâ”€â”€â†’ POS Orders Table                   â”‚             â”‚
â”‚     â”œâ”€â”€â†’ POS OrderItems Table               â”‚             â”‚
â”‚     â””â”€â”€â†’ POS Payments Table                 â”‚             â”‚
â”‚     â†“                                        â”‚             â”‚
â”‚  6. Trigger Kitchen Printing â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Update Loyalty Points                                  â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Send Notification (Socket.IO + Push)                  â”‚
â”‚     â†“                                                       â”‚
â”‚  9. Return Order Confirmation                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Customer   â”‚
                          â”‚   Receives   â”‚
                          â”‚ Confirmation â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Real-time    â”‚
                          â”‚ Status       â”‚
                          â”‚ Updates      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Payment Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAYMENT PROCESSING FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Customer enters payment details at checkout
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Frontend    â”‚
            â”‚  Tokenization â”‚ (Client-side, Authorize.Net Accept.js)
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ Payment Token
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND PAYMENT SERVICE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. Receive payment token + order details                         â”‚
â”‚     â†“                                                               â”‚
â”‚  2. Validate order amount                                          â”‚
â”‚     â†“                                                               â”‚
â”‚  3. Call Authorize.Net API                                         â”‚
â”‚     â”‚                                                               â”‚
â”‚     POST https://api.authorize.net/xml/v1/request.api             â”‚
â”‚     {                                                               â”‚
â”‚       "createTransactionRequest": {                                â”‚
â”‚         "transactionRequest": {                                    â”‚
â”‚           "transactionType": "authCaptureTransaction",            â”‚
â”‚           "amount": total,                                         â”‚
â”‚           "payment": {                                             â”‚
â”‚             "opaqueData": {                                        â”‚
â”‚               "dataValue": paymentToken                            â”‚
â”‚             }                                                       â”‚
â”‚           }                                                         â”‚
â”‚         }                                                           â”‚
â”‚       }                                                             â”‚
â”‚     }                                                               â”‚
â”‚     â†“                                                               â”‚
â”‚  4. Receive Authorize.Net Response                                â”‚
â”‚     â†“                                                               â”‚
â”‚  5. Normalize Response                                             â”‚
â”‚     â”‚                                                               â”‚
â”‚     â”œâ”€ SUCCESS â†’ {                                                â”‚
â”‚     â”‚    status: 'PAID',                                           â”‚
â”‚     â”‚    transactionId: '...',                                     â”‚
â”‚     â”‚    authCode: '...',                                          â”‚
â”‚     â”‚    last4: '...'                                              â”‚
â”‚     â”‚  }                                                            â”‚
â”‚     â”‚                                                               â”‚
â”‚     â””â”€ FAILURE â†’ {                                                â”‚
â”‚          status: 'FAILED',                                         â”‚
â”‚          errorMessage: '...'                                       â”‚
â”‚        }                                                            â”‚
â”‚     â†“                                                               â”‚
â”‚  6. Update Order Payment Status                                    â”‚
â”‚     â†“                                                               â”‚
â”‚  7. Save Payment Record                                            â”‚
â”‚     â†“                                                               â”‚
â”‚  8. If SUCCESS:                                                    â”‚
â”‚     â”œâ”€â†’ Update order status to CONFIRMED                          â”‚
â”‚     â”œâ”€â†’ Send confirmation email                                   â”‚
â”‚     â”œâ”€â†’ Send push notification                                    â”‚
â”‚     â””â”€â†’ Trigger kitchen printing                                  â”‚
â”‚     â†“                                                               â”‚
â”‚  9. If FAILURE:                                                    â”‚
â”‚     â”œâ”€â†’ Mark order as PAYMENT_FAILED                              â”‚
â”‚     â”œâ”€â†’ Log error                                                  â”‚
â”‚     â””â”€â†’ Notify customer                                           â”‚
â”‚     â†“                                                               â”‚
â”‚  10. Return response to frontend                                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                       Customer Receives
                       Confirmation or Error

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        REFUND FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Admin/Customer initiates refund                                    â”‚
â”‚     â†“                                                                â”‚
â”‚  Backend validates refund request                                   â”‚
â”‚     â†“                                                                â”‚
â”‚  Call Authorize.Net refund API                                      â”‚
â”‚     â†“                                                                â”‚
â”‚  Update payment status                                              â”‚
â”‚     â†“                                                                â”‚
â”‚  Restore loyalty points (if used)                                   â”‚
â”‚     â†“                                                                â”‚
â”‚  Notify customer                                                    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Loyalty Program Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOYALTY POINTS FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 EARNING POINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Customer places order
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Completed  â”‚
â”‚  (Status Hook)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LOYALTY POINTS CALCULATION                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Get Active Loyalty Rules                               â”‚
â”‚     â”‚                                                       â”‚
â”‚     SELECT * FROM loyalty_rules                            â”‚
â”‚     WHERE isActive = true                                  â”‚
â”‚     ORDER BY priority DESC                                 â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Apply Rules in Priority Order                          â”‚
â”‚     â”‚                                                       â”‚
â”‚     Rule Types:                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚     â”‚ PERCENTAGE (e.g., 10% of order)     â”‚               â”‚
â”‚     â”‚   Points = orderTotal * (value/100) â”‚               â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚     â”‚ FIXED (e.g., $1 = 1 point)          â”‚               â”‚
â”‚     â”‚   Points = orderTotal * value       â”‚               â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚     â”‚ THRESHOLD (e.g., 500pts if >$50)    â”‚               â”‚
â”‚     â”‚   if orderTotal >= minSpend:        â”‚               â”‚
â”‚     â”‚     Points = value                  â”‚               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Sum total points earned                                â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Update LoyaltyAccount                                  â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATE loyalty_accounts                                â”‚
â”‚     SET pointsBalance = pointsBalance + points            â”‚
â”‚         lifetimePoints = lifetimePoints + points           â”‚
â”‚     WHERE userId = @userId                                 â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Create LoyaltyTransaction Record                       â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO loyalty_transactions                       â”‚
â”‚     (accountId, type, points, orderId, description)        â”‚
â”‚     VALUES (@accountId, 'EARN', @points, @orderId, ...)   â”‚
â”‚     â†“                                                       â”‚
â”‚  6. Check for Tier Upgrade                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     if lifetimePoints >= goldThreshold:                    â”‚
â”‚       UPDATE tier = 'GOLD'                                 â”‚
â”‚     else if lifetimePoints >= silverThreshold:             â”‚
â”‚       UPDATE tier = 'SILVER'                               â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Sync to POS Database                                   â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATE POSCustomerLoyalty                              â”‚
â”‚     SET Points = @newBalance                               â”‚
â”‚     WHERE CustomerID = @posCustomerId                      â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Send Notification                                      â”‚
â”‚     â”‚                                                       â”‚
â”‚     "You earned X points! Balance: Y points"               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 REDEEMING POINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Customer at checkout
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Choose to use   â”‚
â”‚  loyalty points  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LOYALTY REDEMPTION PROCESS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Get Customer Loyalty Account                           â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Validate Points Balance                                â”‚
â”‚     â”‚                                                       â”‚
â”‚     if pointsBalance < pointsToRedeem:                     â”‚
â”‚       return ERROR: Insufficient points                    â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Calculate Discount                                     â”‚
â”‚     â”‚                                                       â”‚
â”‚     pointsToRedeem = min(available, maxAllowed)           â”‚
â”‚     discount = pointsToRedeem * pointValue                â”‚
â”‚     (e.g., 100 points = $10 discount)                     â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Deduct Points                                          â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATE loyalty_accounts                                â”‚
â”‚     SET pointsBalance = pointsBalance - pointsToRedeem    â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Create REDEEM Transaction                              â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO loyalty_transactions                       â”‚
â”‚     (type, points, description)                            â”‚
â”‚     VALUES ('REDEEM', -pointsToRedeem, ...)               â”‚
â”‚     â†“                                                       â”‚
â”‚  6. Apply Discount to Order                                â”‚
â”‚     â”‚                                                       â”‚
â”‚     order.loyaltyDiscount = discount                       â”‚
â”‚     order.total = original - discount                      â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Sync to POS                                            â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATE POSCustomerLoyalty                              â”‚
â”‚     SET Points = @newBalance                               â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Complete Order with Discount                           â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Kitchen Display & Printing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  KITCHEN DISPLAY SYSTEM (KDS) FLOW                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Order Created in System
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ORDER ROUTING LOGIC                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Analyze Order Items                                    â”‚
â”‚     â”‚                                                       â”‚
â”‚     FOR EACH item in order:                                â”‚
â”‚       â”œâ”€ Pizza â†’ Kitchen Printer                           â”‚
â”‚       â”œâ”€ Burger â†’ Grill Station                            â”‚
â”‚       â”œâ”€ Sushi â†’ Sushi Station                             â”‚
â”‚       â”œâ”€ Drinks â†’ Bar Printer                              â”‚
â”‚       â””â”€ Salad â†’ Cold Prep                                 â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Group Items by Station                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     stations = {                                            â”‚
â”‚       'kitchen': [pizza, pasta],                           â”‚
â”‚       'bar': [drinks],                                      â”‚
â”‚       'sushi': [rolls]                                      â”‚
â”‚     }                                                       â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Format Tickets per Station                             â”‚
â”‚     â”‚                                                       â”‚
â”‚     FOR EACH station:                                       â”‚
â”‚       ticket = formatKitchenTicket({                        â”‚
â”‚         orderNumber,                                        â”‚
â”‚         items,                                              â”‚
â”‚         modifiers,                                          â”‚
â”‚         specialInstructions,                                â”‚
â”‚         timestamp,                                          â”‚
â”‚         orderType                                           â”‚
â”‚       })                                                    â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Send to POS Print Queue                                â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO POSPrintQueue                              â”‚
â”‚     (PrinterID, OrderID, TicketData, Priority)             â”‚
â”‚     VALUES (@printerId, @orderId, @ticket, 'HIGH')         â”‚
â”‚     â†“                                                       â”‚
â”‚  5. POS Detects New Print Job                              â”‚
â”‚     â”‚                                                       â”‚
â”‚     (POS polling or trigger monitors POSPrintQueue)        â”‚
â”‚     â†“                                                       â”‚
â”‚  6. POS Routes to Physical Printer                         â”‚
â”‚     â”‚                                                       â”‚
â”‚     Based on PrinterID:                                    â”‚
â”‚     â”œâ”€â†’ Kitchen Printer (IP: 192.168.1.101)                â”‚
â”‚     â”œâ”€â†’ Bar Printer (IP: 192.168.1.102)                    â”‚
â”‚     â””â”€â†’ Expo Printer (IP: 192.168.1.103)                   â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Physical Print Occurs                                  â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚  KITCHEN TICKET             â”‚                        â”‚
â”‚     â”‚  Order #: ORD-2025-001      â”‚                        â”‚
â”‚     â”‚  Time: 12:34 PM             â”‚                        â”‚
â”‚     â”‚  Type: DELIVERY             â”‚                        â”‚
â”‚     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                        â”‚
â”‚     â”‚  1x Margherita Pizza        â”‚                        â”‚
â”‚     â”‚     + Extra Cheese          â”‚                        â”‚
â”‚     â”‚  1x Caesar Salad            â”‚                        â”‚
â”‚     â”‚     - No Croutons           â”‚                        â”‚
â”‚     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                        â”‚
â”‚     â”‚  RUSH! 30min delivery       â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Update Print Status                                    â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATE POSPrintQueue                                   â”‚
â”‚     SET Status = 'PRINTED', PrintedAt = GETDATE()          â”‚
â”‚     â†“                                                       â”‚
â”‚  9. Kitchen Confirms Receipt (Optional)                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 ALTERNATIVE: Direct Network Printing (If no POS queue)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Order Created
     â”‚
     â–¼
Backend formats ESC/POS commands
     â”‚
     â–¼
Send to printer IP directly (port 9100)
     â”‚
     â”œâ”€â†’ 192.168.1.101:9100 (Kitchen)
     â”œâ”€â†’ 192.168.1.102:9100 (Bar)
     â””â”€â†’ 192.168.1.103:9100 (Sushi)
     â”‚
     â–¼
Ticket prints immediately
```

---

## 3. API Request/Response Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API REQUEST FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client (Web/Mobile App)
         â”‚
         â”‚ HTTP Request
         â”‚ Authorization: Bearer <token>
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXPRESS MIDDLEWARE CHAIN                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. CORS Middleware                                        â”‚
â”‚     â†“ Check origin, set headers                            â”‚
â”‚                                                             â”‚
â”‚  2. Helmet (Security Headers)                              â”‚
â”‚     â†“ Add security headers                                 â”‚
â”‚                                                             â”‚
â”‚  3. Rate Limiter                                           â”‚
â”‚     â†“ Check request rate                                   â”‚
â”‚     â”‚                                                       â”‚
â”‚     if exceeded â†’ Return 429 Too Many Requests             â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Body Parser                                            â”‚
â”‚     â†“ Parse JSON body                                      â”‚
â”‚                                                             â”‚
â”‚  5. Morgan Logger                                          â”‚
â”‚     â†“ Log request                                          â”‚
â”‚                                                             â”‚
â”‚  6. Authentication Middleware (if protected route)         â”‚
â”‚     â†“                                                       â”‚
â”‚     Extract token from header                              â”‚
â”‚     â†“                                                       â”‚
â”‚     Verify JWT signature                                   â”‚
â”‚     â†“                                                       â”‚
â”‚     Check expiration                                       â”‚
â”‚     â†“                                                       â”‚
â”‚     if invalid â†’ Return 401 Unauthorized                   â”‚
â”‚     â†“                                                       â”‚
â”‚     Attach user to request: req.user                       â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Authorization Middleware (if role required)            â”‚
â”‚     â†“                                                       â”‚
â”‚     Check user role                                        â”‚
â”‚     â†“                                                       â”‚
â”‚     if insufficient â†’ Return 403 Forbidden                 â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Route to Controller                                    â”‚
â”‚     â†“                                                       â”‚
â”‚  9. Controller validates input                             â”‚
â”‚     â†“                                                       â”‚
â”‚  10. Controller calls Service                              â”‚
â”‚      â†“                                                      â”‚
â”‚  11. Service performs business logic                       â”‚
â”‚      â†“                                                      â”‚
â”‚  12. Service calls Prisma ORM                              â”‚
â”‚      â†“                                                      â”‚
â”‚  13. Database query executed                               â”‚
â”‚      â†“                                                      â”‚
â”‚  14. Data returned to Service                              â”‚
â”‚      â†“                                                      â”‚
â”‚  15. Service transforms/formats data                       â”‚
â”‚      â†“                                                      â”‚
â”‚  16. Service returns to Controller                         â”‚
â”‚      â†“                                                      â”‚
â”‚  17. Controller sends response                             â”‚
â”‚      â†“                                                      â”‚
â”‚  18. Response logging                                      â”‚
â”‚      â†“                                                      â”‚
â”‚  19. Return to client                                      â”‚
â”‚                                                             â”‚
â”‚  ERROR at any step â†’ Error Handler Middleware              â”‚
â”‚     â†“                                                       â”‚
â”‚     Log error                                              â”‚
â”‚     â†“                                                       â”‚
â”‚     Format error response                                  â”‚
â”‚     â†“                                                       â”‚
â”‚     Return appropriate status code                         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Complete Order Status Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ORDER STATUS LIFECYCLE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      PENDING
         â”‚ Order placed by customer
         â”‚ Awaiting restaurant confirmation
         â–¼
      CONFIRMED
         â”‚ Restaurant accepts order
         â”‚ Payment authorized
         â–¼
      PREPARING
         â”‚ Kitchen starts cooking
         â”‚ Items being prepared
         â–¼
        READY
         â”‚ Food ready
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â–¼         â–¼
 PICKUP   OUT_FOR_DELIVERY
    â”‚         â”‚ Driver assigned
    â”‚         â”‚ On the way
    â”‚         â–¼
    â”‚      DELIVERED
    â”‚         â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â–¼
     COMPLETED
         â”‚ Order fulfilled
         â”‚ Payment captured
         â”‚ Loyalty points awarded

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CANCELLED  â”‚ Can occur from PENDING, CONFIRMED
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Status Update Triggers
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Each status change:
  1. Update database
  2. Create status history record
  3. Sync to POS database
  4. Send Socket.IO event
  5. Send push notification
  6. Log event
```

---

## 5. Real-Time Communication Flow (Socket.IO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOCKET.IO REAL-TIME FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Client Connects to Backend
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Socket.IO       â”‚
â”‚  Handshake       â”‚
â”‚                  â”‚
â”‚  - Authenticate  â”‚
â”‚  - Join rooms    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client subscribes to channels:            â”‚
â”‚                                             â”‚
â”‚  socket.join(`user:${userId}`)             â”‚
â”‚  socket.join(`order:${orderId}`)           â”‚
â”‚  socket.join(`location:${locationId}`)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Connection established
         â”‚
    [REALTIME EVENTS]
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                â”‚
    â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Event â”‚              â”‚  Menu Event  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                              â”‚
      â”‚                              â”‚
Backend emits:                Backend emits:
io.to(`user:${userId}`)       io.to('all').emit()
  .emit('order:updated')        .emit('menu:updated')
      â”‚                              â”‚
      â–¼                              â–¼
Client receives event         Client receives event
      â”‚                              â”‚
      â–¼                              â–¼
Update UI (order status)      Refresh menu data
      â”‚                              â”‚
      â–¼                              â–¼
Show notification            Update cache

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 Event Types & Payloads
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

order:created
  { orderId, orderNumber, status, timestamp }

order:updated
  { orderId, status, estimatedTime, message }

order:cancelled
  { orderId, reason }

delivery:location
  { orderId, driverId, latitude, longitude, eta }

menu:updated
  { itemId, changes: ['price', 'availability'] }

loyalty:updated
  { userId, newBalance, pointsEarned }
```

---

## 6. User Registration & Onboarding Flow

```
New User Opens App/Website
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sign Up Form    â”‚
â”‚  - Email         â”‚
â”‚  - Password      â”‚
â”‚  - Name          â”‚
â”‚  - Phone         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Frontend Validation
  - Email format
  - Password strength (8+ chars, upper, lower, number)
  - Required fields
         â”‚
         â–¼
POST /api/v1/auth/register
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND REGISTRATION PROCESS                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Validate input data                                    â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Check if email already exists                          â”‚
â”‚     â”‚                                                       â”‚
â”‚     if exists â†’ Return 400 "Email already registered"      â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Hash password (bcrypt, salt rounds: 10)                â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Create User record                                     â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO users                                      â”‚
â”‚     (email, password, firstName, lastName, role)           â”‚
â”‚     VALUES (@email, @hashedPassword, ..., 'CUSTOMER')      â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Create Customer record                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO customers (userId)                         â”‚
â”‚     â†“                                                       â”‚
â”‚  6. Create Loyalty Account                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO loyalty_accounts                           â”‚
â”‚     (userId, pointsBalance, tier)                          â”‚
â”‚     VALUES (@userId, 0, 'bronze')                          â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Generate JWT tokens                                    â”‚
â”‚     â”‚                                                       â”‚
â”‚     accessToken = jwt.sign(payload, secret, { 7d })        â”‚
â”‚     refreshToken = jwt.sign(payload, secret, { 30d })      â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Store refresh token                                    â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO refresh_tokens                             â”‚
â”‚     (token, userId, expiresAt)                             â”‚
â”‚     â†“                                                       â”‚
â”‚  9. Send welcome email (optional)                          â”‚
â”‚     â†“                                                       â”‚
â”‚  10. Return user + tokens                                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                  Client receives:
                  {
                    user: { id, email, firstName, ... },
                    accessToken: "...",
                    refreshToken: "..."
                  }
                          â”‚
                          â–¼
                  Auto-login user
                          â”‚
                          â–¼
                  Redirect to dashboard
```

---

## 7. Menu Synchronization Flow (POS â†’ App)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MENU SYNC FROM POS                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scheduled Job runs every 60 seconds
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 SYNC SERVICE PROCESS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Connect to POS SQL Server                              â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Query Menu Data                                        â”‚
â”‚     â”‚                                                       â”‚
â”‚     SELECT * FROM POSCategories WHERE Active = 1           â”‚
â”‚     SELECT * FROM POSMenuItems WHERE Active = 1            â”‚
â”‚     SELECT * FROM POSModifiers WHERE Active = 1            â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Compare with Current Data                              â”‚
â”‚     â”‚                                                       â”‚
â”‚     FOR EACH POS item:                                     â”‚
â”‚       Find matching item in our DB                         â”‚
â”‚       Compare: name, price, description, availability      â”‚
â”‚       if different â†’ Mark for update                       â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Process Changes                                        â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATES:                                               â”‚
â”‚     â””â”€â†’ UPDATE our_items SET price = pos_price            â”‚
â”‚                                                             â”‚
â”‚     NEW ITEMS:                                             â”‚
â”‚     â””â”€â†’ INSERT INTO our_items (...)                       â”‚
â”‚                                                             â”‚
â”‚     DEACTIVATED:                                           â”‚
â”‚     â””â”€â†’ UPDATE our_items SET isActive = false             â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Update Last Sync Timestamp                             â”‚
â”‚     â†“                                                       â”‚
â”‚  6. Emit Socket.IO Events                                  â”‚
â”‚     â”‚                                                       â”‚
â”‚     io.emit('menu:updated', { changes })                   â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Connected Apps Receive Update                          â”‚
â”‚     â”‚                                                       â”‚
â”‚     Customer App â†’ Refresh menu cache                      â”‚
â”‚     Website â†’ Invalidate menu query                        â”‚
â”‚     Admin Portal â†’ Show notification                       â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Log Sync Results                                       â”‚
â”‚     â”‚                                                       â”‚
â”‚     "Menu sync completed: 3 updates, 1 new, 0 deleted"     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CRITICAL: Sync must complete in < 5 seconds to avoid timeout
```

---

## 8. Delivery Assignment & Tracking Flow

```
Order Status = OUT_FOR_DELIVERY
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DELIVERY ASSIGNMENT PROCESS                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Find Available Drivers                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     SELECT * FROM employees                                â”‚
â”‚     WHERE position = 'driver'                              â”‚
â”‚       AND isActive = true                                  â”‚
â”‚       AND currentOrderId IS NULL                           â”‚
â”‚     â†“                                                       â”‚
â”‚  2. Calculate Distance to Restaurant                       â”‚
â”‚     â”‚ (Using driver's last known location)                â”‚
â”‚     â†“                                                       â”‚
â”‚  3. Select Nearest Driver                                  â”‚
â”‚     â†“                                                       â”‚
â”‚  4. Create Delivery Record                                 â”‚
â”‚     â”‚                                                       â”‚
â”‚     INSERT INTO deliveries                                 â”‚
â”‚     (orderId, driverId, status, pickupAddress, ...)        â”‚
â”‚     â†“                                                       â”‚
â”‚  5. Update Driver Assignment                               â”‚
â”‚     â”‚                                                       â”‚
â”‚     UPDATE employees                                       â”‚
â”‚     SET currentOrderId = @orderId                          â”‚
â”‚     â†“                                                       â”‚
â”‚  6. Send Push Notification to Driver                       â”‚
â”‚     â”‚                                                       â”‚
â”‚     "New delivery assigned! Pickup at Main St"             â”‚
â”‚     â†“                                                       â”‚
â”‚  7. Driver Accepts                                         â”‚
â”‚     â”‚                                                       â”‚
â”‚     PATCH /delivery/:id/status â†’ 'ASSIGNED'                â”‚
â”‚     â†“                                                       â”‚
â”‚  8. Driver Picks Up Order                                  â”‚
â”‚     â”‚                                                       â”‚
â”‚     PATCH /delivery/:id/status â†’ 'PICKED_UP'               â”‚
â”‚     â†“                                                       â”‚
â”‚  9. Driver Starts Navigation                               â”‚
â”‚     â”‚                                                       â”‚
â”‚     Location updates every 10 seconds                      â”‚
â”‚     Socket.IO: emit('delivery:location', { lat, lng })     â”‚
â”‚     â†“                                                       â”‚
â”‚  10. Customer Tracks in Real-Time                          â”‚
â”‚      â”‚                                                      â”‚
â”‚      Map shows driver location                             â”‚
â”‚      ETA calculated                                        â”‚
â”‚      â†“                                                      â”‚
â”‚  11. Driver Arrives & Delivers                             â”‚
â”‚      â”‚                                                      â”‚
â”‚      PATCH /delivery/:id/status â†’ 'DELIVERED'              â”‚
â”‚      â†“                                                      â”‚
â”‚  12. Order Status â†’ COMPLETED                              â”‚
â”‚      â”‚                                                      â”‚
â”‚      Loyalty points awarded                                â”‚
â”‚      Driver marked available                               â”‚
â”‚      Customer notified                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Complete System Integration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 END-TO-END SYSTEM INTEGRATION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Customer App/Website]
         â”‚
         â”‚ 1. Place Order
         â–¼
[Our Backend API]
         â”‚
         â”œâ”€â†’ 2. Save to Our Database (PostgreSQL)
         â”‚
         â”œâ”€â†’ 3. Process Payment (Authorize.Net)
         â”‚
         â”œâ”€â†’ 4. Post to POS Database (SQL Server)
         â”‚        â”‚
         â”‚        â””â”€â†’ Triggers Kitchen Print
         â”‚
         â”œâ”€â†’ 5. Calculate Loyalty Points
         â”‚        â”‚
         â”‚        â””â”€â†’ Sync to POS Loyalty Table
         â”‚
         â”œâ”€â†’ 6. Send Confirmations
         â”‚        â”œâ”€â†’ Socket.IO (real-time)
         â”‚        â”œâ”€â†’ Push Notification
         â”‚        â””â”€â†’ Email/SMS
         â”‚
         â””â”€â†’ 7. Update Admin Dashboard
         â–¼
[Kitchen Printer] Ticket prints
         â”‚
         â–¼
[Kitchen Staff] Prepares order
         â”‚
         â–¼
[POS System] Status updated
         â”‚
         â–¼
[Our Backend] Detects status change (polling/trigger)
         â”‚
         â–¼
[Socket.IO] Broadcasts update
         â”‚
         â–¼
[Customer App] Shows "Order is being prepared..."
         â”‚
         â–¼
[Delivery Assignment] (if delivery order)
         â”‚
         â–¼
[Driver App] Receives assignment
         â”‚
         â–¼
[Driver] Picks up & delivers
         â”‚
         â–¼
[Customer] Receives order
         â”‚
         â–¼
[System] Awards loyalty points
         â”‚
         â–¼
[Cycle Complete] ğŸ‰
```

---

All flows documented with precision! Ready for client review! ğŸ“‹âœ…

